---
import '../../styles/globals.css';
import { ClientHeader } from '../../components/ClientHeader';
import { Footer } from '../../components/layout/Footer';
import { getThemeScript } from '../../components/ThemeProvider';
import { BlogNewsletter, RelatedPosts } from '../../components/sections';
import { AuthorBio } from '../../components/blog/AuthorBio';
import { blogPosts, type BlogPost } from '../../data/blog';
import { Container } from '../../components/ui/Container';
import { Section } from '../../components/ui/Section';
import { Badge } from '../../components/ui/Badge';
import { Calendar, Clock, ChevronLeft } from 'lucide-react';
import { Link } from '../../components/ui/Link';
import { ROUTES } from '../../config/paths';

export async function getStaticPaths() {
  return blogPosts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

interface Props {
  post: BlogPost;
}

const { post } = Astro.props;
const {
  title,
  excerpt,
  content,
  category,
  author,
  publishedAt,
  readingTime,
  coverImage,
  tags,
  relatedPosts: relatedPostIds,
} = post;

// Format date
const formattedDate = new Date(publishedAt).toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});

// Get related post objects
const relatedPosts = blogPosts.filter((p) => relatedPostIds?.includes(p.id));
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>{title} | ModernSaaS Blog</title>
    <meta name="description" content={excerpt} />
    <!-- Theme script to prevent flash of wrong theme -->
    <script is:inline set:html={getThemeScript('system')} />
  </head>
  <body class="min-h-screen bg-bg-primary text-text-primary antialiased">
    <!-- Skip to content link for accessibility -->
    <a
      href="#main-content"
      class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-primary-600 focus:text-white focus:rounded-lg focus:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-600 transition-all"
    >
      Skip to content
    </a>

    <ClientHeader client:load />

    <main id="main-content" tabindex="-1" role="main" aria-label={`Blog post: ${title}`}>
      {/* 1. Post Hero */}
      <Section background="transparent" padding="xl" className="pt-32 pb-12 sm:pt-40">
        <Container size="narrow">
          <Link
            href={ROUTES.BLOG}
            variant="subtle"
            className="inline-flex items-center gap-2 mb-8 group"
          >
            <ChevronLeft className="w-4 h-4 transition-transform group-hover:-translate-x-1" />
            Back to Blog
          </Link>

          <div class="space-y-6">
            <Badge variant="info" className="uppercase tracking-wider">
              {category}
            </Badge>

            <h1
              class="text-4xl sm:text-5xl md:text-6xl font-extrabold text-text-primary leading-tight tracking-tight"
            >
              {title}
            </h1>

            <p class="text-xl text-text-secondary leading-relaxed">
              {excerpt}
            </p>

            <div class="flex flex-wrap items-center gap-6 pt-4 text-sm text-text-muted">
              <div class="flex items-center gap-2">
                <div class="w-8 h-8 rounded-full overflow-hidden border border-border-default">
                  <img src={author.avatar} alt={author.name} class="w-full h-full object-cover" />
                </div>
                <span class="font-medium text-text-secondary">{author.name}</span>
              </div>

              <div class="flex items-center gap-2">
                <Calendar className="w-4 h-4" />
                <time datetime={publishedAt}>{formattedDate}</time>
              </div>

              <div class="flex items-center gap-2">
                <Clock className="w-4 h-4" />
                <span>{readingTime} min read</span>
              </div>
            </div>
          </div>
        </Container>
      </Section>

      {/* 2. Featured Image */}
      <Section background="transparent" padding="none" className="mb-12">
        <Container size="default">
          <div
            class="relative aspect-[21/9] rounded-2xl overflow-hidden shadow-2xl border border-border-default"
          >
            <img src={coverImage} alt={title} class="w-full h-full object-cover" />
          </div>
        </Container>
      </Section>

      {/* 3. Post Content */}
      <Section background="transparent" padding="lg">
        <Container size="narrow">
          <article class="prose prose-lg dark:prose-invert prose-primary max-w-none">
            {/* Placeholder content until real MDX is integrated */}
            <div class="space-y-6 text-text-secondary leading-relaxed text-lg">
              {
                content ? (
                  <div set:html={content} />
                ) : (
                  <>
                    <p>
                      Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor
                      incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis
                      nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
                    </p>
                    <h2 class="text-2xl font-bold text-text-primary pt-4">The Future of SaaS</h2>
                    <p>
                      Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore
                      eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt
                      in culpa qui officia deserunt mollit anim id est laborum.
                    </p>
                    <blockquote class="border-l-4 border-primary-500 pl-6 py-2 italic text-xl text-text-primary bg-primary-50/30 dark:bg-primary-900/10 rounded-r-lg">
                      "The best way to predict the future is to create it. Innovation distinguishes
                      between a leader and a follower."
                    </blockquote>
                    <p>
                      Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium
                      doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore
                      veritatis et quasi architecto beatae vitae dicta sunt explicabo.
                    </p>
                    <h2 class="text-2xl font-bold text-text-primary pt-4">Key Takeaways</h2>
                    <ul class="list-disc pl-6 space-y-2">
                      <li>Focus on user experience above all else</li>
                      <li>Iterate quickly based on customer feedback</li>
                      <li>Build scalable infrastructure from day one</li>
                      <li>Prioritize security and data privacy</li>
                    </ul>
                    <p>
                      Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit,
                      sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt.
                    </p>
                  </>
                )
              }
            </div>

            {/* Tags */}
            <div class="flex flex-wrap gap-2 mt-12 pt-8 border-t border-border-default">
              {
                tags.map((tag) => (
                  <Badge variant="default" className="bg-bg-secondary text-text-secondary">
                    #{tag}
                  </Badge>
                ))
              }
            </div>
          </article>

          {/* 4. Author Bio */}
          <div class="mt-16">
            <AuthorBio author={author} />
          </div>
        </Container>
      </Section>

      {/* 5. Related Posts */}
      {relatedPosts.length > 0 && <RelatedPosts posts={relatedPosts} />}

      {/* 6. Newsletter Section */}
      <BlogNewsletter client:visible />
    </main>

    <Footer />
  </body>
</html>
